## WireGuard Android版アプリにおけるフルトンネル設定＋プライベートIPアドレス除外

フルトンネル時のクライアント側のAllowedIPs設定値は「0.0.0.0/0, ::/0」だが、これではすべてのトラフィックがトンネルに入り、クライアント自身のLANの機器に到達できない（WireGuardサーバーを置いているLANの機器にアクセスする）。

WireGuard Android版アプリでピア > Allowed IPsに「0.0.0.0/0, ::/0」を設定値すると「プライベートIPアドレスを除外」というチェックボックスが現れる。これを有効化すると、Allowed IPsが以下のように変化する。

```
0.0.0.0/5, 8.0.0.0/7, 11.0.0.0/8, 12.0.0.0/6, 16.0.0.0/4, 32.0.0.0/3, 64.0.0.0/2, 128.0.0.0/3, 160.0.0.0/5, 168.0.0.0/6, 172.0.0.0/12, 172.32.0.0/11, 172.64.0.0/10, 172.128.0.0/9, 173.0.0.0/8, 174.0.0.0/7, 176.0.0.0/4, 192.0.0.0/9, 192.128.0.0/11, 192.160.0.0/13, 192.169.0.0/16, 192.170.0.0/15, 192.172.0.0/14, 192.176.0.0/12, 192.192.0.0/10, 193.0.0.0/8, 194.0.0.0/7, 196.0.0.0/6, 200.0.0.0/5, 208.0.0.0/4, ::/0, 1.1.1.1/32
```

IPv6は自動で除外されない。1.1.1.1はDNSに指定したアドレス。

この場合はLAN機器にはアクセスでき、フルトンネルも成立するものの、クライアントからVPN内の機器にアクセスできない。

WireGuard Android版アプリでフルトンネル＋クライアント自身のLANアクセス＋クライアントからのVPN内アクセスを両立するには、Allowed IPsに「0.0.0.0/0, 2000::/3, 10.8.0.0/24, fd42:42:42::/64」（VPN内でクライアントのInterface.Addressに10.8.0.n/24, fd42:42:42::n/64を与える規則を用いている場合）を指定した上で「プライベートIPアドレスを除外」を有効化した以下のリストを用いる。なお::/0はプライベートIPアドレスの除外が自動適用されないため、手動でグローバルユニキャストアドレスの範囲である2000::/3を指定した。

```
0.0.0.0/5, 8.0.0.0/7, 11.0.0.0/8, 12.0.0.0/6, 16.0.0.0/4, 32.0.0.0/3, 64.0.0.0/2, 128.0.0.0/3, 160.0.0.0/5, 168.0.0.0/6, 172.0.0.0/12, 172.32.0.0/11, 172.64.0.0/10, 172.128.0.0/9, 173.0.0.0/8, 174.0.0.0/7, 176.0.0.0/4, 192.0.0.0/9, 192.128.0.0/11, 192.160.0.0/13, 192.169.0.0/16, 192.170.0.0/15, 192.172.0.0/14, 192.176.0.0/12, 192.192.0.0/10, 193.0.0.0/8, 194.0.0.0/7, 196.0.0.0/6, 200.0.0.0/5, 208.0.0.0/4, 2000::/3, 10.8.0.0/24, fd42:42:42::/64, 1.1.1.1/32
```
