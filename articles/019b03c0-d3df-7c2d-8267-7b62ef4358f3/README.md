## 3DS自動化におけるタッチスクリーン操作

[Pokémon Past Generation Advent Calendar 2025](https://adventar.org/calendars/11526) 10日目の記事です。昨日はニアトさんの「[第五世代乱数調整ツールをwebアプリ化した話](https://hackmd.io/@niart/rktr1xJfbg)」でした。Linuxデスクトップユーザーとしては助かりますね。明日は奈都さんの「WISHMKR＆Channelジラーチの完全自動化」の予定です。GC自動化にもかなり関わったので楽しみです。

予告は「3DS自動化のなんらか」でしたが、新作ではないです、すみません。ほんとうは雑MCPサーバーを作ってAIにポケモンをやらせるつもりでした、これも間に合わなくてすみません。これはふつうに楽しそうなので、年末年始のおやすみにでもやります。また来てください、本物の記事を見せてあげますよ。

代わりに、液タブを買ってきました。幾多の小学生のDSを破壊したポケモンレンジャーを大画面で楽しめます。画面壊しそ〜めちゃ怖いですが、本当に楽しいので一度やってみてほしいです。オフ会で体験会とかやれたらいいのかな。

> 液タブがあったらデカいDSができるなあと思っていましたがやっている人を見つけられなかったので、自分で買ってきてやってみました。
>
> https://x.com/i/status/1998402229318156593

ちなみに遅延があるのは偽トロビュアーとqingpictlを動かしているWindowsが仮想マシンだからだと思われます。qingpictlはマルチプラットフォームにしないといけませんね。偽トロビュアーはサードパーティのマルチプラットフォームのアプリがあるようです。最近偽トロにも対応したそうなので、ぜひ試したいところです。[Lorenzooone/cc3dsfs](https://github.com/Lorenzooone/cc3dsfs)

[Qingpi](https://github.com/u1f992/qingpi)を開発するうえで譲れない点がタッチスクリーン操作を実現することでした。DS／3DSシリーズのタッチスクリーンは抵抗膜方式が採用されています。これは2枚の膜が入力によって接触して導通する方式で、モデル化すると2つの可変抵抗のワイパー同士がスイッチで接続されたような構造です。この可変抵抗の両端計4端子に、シリアル通信で制御する可変抵抗であるデジタルポテンショメータとCMOSアナログスイッチからなる疑似タッチスクリーンを構築するのがQingpiに搭載した回路でした。これはなんとか出せるものになりましたが、いくつか気になっている点もあります。

いろいろ試作した結果、今年販売開始された総抵抗値5kΩ・1024分解能のデジタルポテンショメータMCP32U4と、4線すべてを同時にオープン／クローズする新しい回路が役に立ちそうです。MCP32U4は3.3V駆動で十分にワイパー抵抗値が小さく、ステップ数も大幅に増えます。総抵抗値5kΩなら画面の全範囲で入力判定を起こせるようです。また4線すべてを切り替えることで、スイッチの両方向信号に対する特性の差を無視できます。

> 最近発売されたMCP42U83を使用すると縦横1024段階の入力が可能になりました。1024段階のデジタルポテンショメータはこれまで10kΩ以上の製品しか手に入らず、入力判定を起こせないので断念していました。従来使用していたものより小さく配線もシンプルで、5V電源を用意する必要がないのも嬉しいところ。
>
> https://x.com/i/status/1992928305759367447

あまり時間をかけられていないのですが、放棄したわけではありません。気が向いてお金がある時に完成させるつもりです。

